// ุณูุฑูุจุช ุฅูุดุงุก ููู Excel ูููุฐุฌู ุจุงูุญููู ุงูุฌุฏูุฏุฉ
import XLSX from 'xlsx';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

// ุงูุญุตูู ุนูู ูุณุงุฑ ุงูููู ุงูุญุงูู
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

console.log('๐ ุฅูุดุงุก ููู Excel ูููุฐุฌู ุจุงูุญููู ุงูุฌุฏูุฏุฉ...');
console.log('============================================');

// ุจูุงูุงุช ูููุฐุฌูุฉ ููููุธููู
const sampleData = [
  {
    'ุงูุฑูู': '946',
    'ุงุณู ุงูููุธู': 'ุนูุงู ูุญูุฏ ุดุญุงุชู ูุญูุฏ',
    'ุงููุฑุงูุจ': 'ุนุซูุงู ุงูุฑูุงุนู',
    'ุงูุฑุงุชุจ ุงูุฃุณุงุณู': 8.25,
    'ุฃูุงู ุงูุดูุฑ': 31,
    'ุงูุนุทู': 1,
    'ุงูุฌูุน ูุงูุนุทู': 4,
    'ุงูุฅุถุงูู ุจุนุฏ ุงููุฑุฌุน': 1,
    'ููุงุญุธุงุช': ''
  },
  {
    'ุงูุฑูู': '947',
    'ุงุณู ุงูููุธู': 'ุฃุญูุฏ ูุญูุฏ ุนูู',
    'ุงููุฑุงูุจ': 'ุนุซูุงู ุงูุฑูุงุนู',
    'ุงูุฑุงุชุจ ุงูุฃุณุงุณู': 9.50,
    'ุฃูุงู ุงูุดูุฑ': 31,
    'ุงูุนุทู': 2,
    'ุงูุฌูุน ูุงูุนุทู': 3,
    'ุงูุฅุถุงูู ุจุนุฏ ุงููุฑุฌุน': 2,
    'ููุงุญุธุงุช': 'ููุธู ุฌุฏูุฏ'
  },
  {
    'ุงูุฑูู': '948',
    'ุงุณู ุงูููุธู': 'ูุงุทูุฉ ุฃุญูุฏ ุงูุณุนูุฏ',
    'ุงููุฑุงูุจ': 'ูููู - ูุงูู ุงูุนุงูุณุฉ',
    'ุงูุฑุงุชุจ ุงูุฃุณุงุณู': 7.75,
    'ุฃูุงู ุงูุดูุฑ': 30,
    'ุงูุนุทู': 0,
    'ุงูุฌูุน ูุงูุนุทู': 2,
    'ุงูุฅุถุงูู ุจุนุฏ ุงููุฑุฌุน': 1,
    'ููุงุญุธุงุช': ''
  },
  {
    'ุงูุฑูู': '949',
    'ุงุณู ุงูููุธู': 'ูุญูุฏ ุนุจุฏุงููู ุงููุญุทุงูู',
    'ุงููุฑุงูุจ': 'ุญูููุง - ุฃุญูุฏ ุณุนูุฏ ุงูุฑูุงุฌุญ',
    'ุงูุฑุงุชุจ ุงูุฃุณุงุณู': 10.25,
    'ุฃูุงู ุงูุดูุฑ': 31,
    'ุงูุนุทู': 1,
    'ุงูุฌูุน ูุงูุนุทู': 5,
    'ุงูุฅุถุงูู ุจุนุฏ ุงููุฑุฌุน': 3,
    'ููุงุญุธุงุช': 'ุนูู ุฅุถุงูู'
  },
  {
    'ุงูุฑูู': '950',
    'ุงุณู ุงูููุธู': 'ููุฑุง ุณุนุฏ ุงููุทูุฑู',
    'ุงููุฑุงูุจ': 'ุญู ุงูุฒุฑุงุนุฉ - ุฃุญูุฏ ุณุนูุฏ',
    'ุงูุฑุงุชุจ ุงูุฃุณุงุณู': 8.75,
    'ุฃูุงู ุงูุดูุฑ': 31,
    'ุงูุนุทู': 0,
    'ุงูุฌูุน ูุงูุนุทู': 1,
    'ุงูุฅุถุงูู ุจุนุฏ ุงููุฑุฌุน': 0,
    'ููุงุญุธุงุช': ''
  }
];

// ุฏุงูุฉ ูุญุณุงุจ ุงูุฑุงุชุจ ุจุงุณุชุฎุฏุงู ุงููุนุงุฏูุงุช ุงูุฌุฏูุฏุฉ
function calculateSalaryWithNewFormulas(baseSalary, daysInMonth, holidays, fridaysAndHolidays, overtimeAfterReference) {
  // totalOvertime = (D2*I2*0.5) + (E2*I2) + (F2*I2)
  const totalOvertime = (holidays * baseSalary * 0.5) + 
                       (fridaysAndHolidays * baseSalary) + 
                       (overtimeAfterReference * baseSalary);
  
  // totalSalary = C2*I2
  const totalSalary = daysInMonth * baseSalary;
  
  // netSalary = L2 + K2
  const netSalary = totalSalary + totalOvertime;
  
  return {
    totalOvertime: Math.round(totalOvertime * 1000) / 1000,
    totalSalary: Math.round(totalSalary * 1000) / 1000,
    netSalary: Math.round(netSalary * 1000) / 1000
  };
}

// ุฅุถุงูุฉ ุงูุญุณุงุจุงุช ุฅูู ุงูุจูุงูุงุช
const dataWithCalculations = sampleData.map(row => {
  const calculations = calculateSalaryWithNewFormulas(
    row['ุงูุฑุงุชุจ ุงูุฃุณุงุณู'],
    row['ุฃูุงู ุงูุดูุฑ'],
    row['ุงูุนุทู'],
    row['ุงูุฌูุน ูุงูุนุทู'],
    row['ุงูุฅุถุงูู ุจุนุฏ ุงููุฑุฌุน']
  );
  
  return {
    ...row,
    'ุฅุฌูุงูู ุงูุฅุถุงูู': calculations.totalOvertime,
    'ุฅุฌูุงูู ุงูุฑุงุชุจ': calculations.totalSalary,
    'ุตุงูู ุงูุฑุงุชุจ': calculations.netSalary
  };
});

// ุฅูุดุงุก ูุฑูุฉ ุนูู
const worksheet = XLSX.utils.json_to_sheet(dataWithCalculations);

// ุชูุณูู ุงูุฃุนูุฏุฉ
const columnWidths = [
  { wch: 8 },   // ุงูุฑูู
  { wch: 25 },  // ุงุณู ุงูููุธู
  { wch: 20 },  // ุงููุฑุงูุจ
  { wch: 12 },  // ุงูุฑุงุชุจ ุงูุฃุณุงุณู
  { wch: 10 },  // ุฃูุงู ุงูุดูุฑ
  { wch: 8 },   // ุงูุนุทู
  { wch: 12 },  // ุงูุฌูุน ูุงูุนุทู
  { wch: 15 },  // ุงูุฅุถุงูู ุจุนุฏ ุงููุฑุฌุน
  { wch: 12 },  // ุฅุฌูุงูู ุงูุฅุถุงูู
  { wch: 12 },  // ุฅุฌูุงูู ุงูุฑุงุชุจ
  { wch: 12 },  // ุตุงูู ุงูุฑุงุชุจ
  { wch: 15 }   // ููุงุญุธุงุช
];

worksheet['!cols'] = columnWidths;

// ุฅูุดุงุก ูุตูู
const workbook = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(workbook, worksheet, 'ุงูุฑูุงุชุจ');

// ุญูุธ ุงูููู
const outputPath = join(__dirname, 'excel-template-updated.xlsx');
XLSX.writeFile(workbook, outputPath);

console.log('โ ุชู ุฅูุดุงุก ููู Excel ุงููููุฐุฌู ุจูุฌุงุญ!');
console.log(`๐ ูุณุงุฑ ุงูููู: ${outputPath}`);
console.log('\n๐ ุงูุฃุนูุฏุฉ ุงููุชุถููุฉ:');
console.log('   - ุงูุฑูู');
console.log('   - ุงุณู ุงูููุธู');
console.log('   - ุงููุฑุงูุจ');
console.log('   - ุงูุฑุงุชุจ ุงูุฃุณุงุณู');
console.log('   - ุฃูุงู ุงูุดูุฑ');
console.log('   - ุงูุนุทู');
console.log('   - ุงูุฌูุน ูุงูุนุทู');
console.log('   - ุงูุฅุถุงูู ุจุนุฏ ุงููุฑุฌุน');
console.log('   - ุฅุฌูุงูู ุงูุฅุถุงูู (ูุญุณูุจ)');
console.log('   - ุฅุฌูุงูู ุงูุฑุงุชุจ (ูุญุณูุจ)');
console.log('   - ุตุงูู ุงูุฑุงุชุจ (ูุญุณูุจ)');
console.log('   - ููุงุญุธุงุช');

console.log('\n๐งฎ ุงููุนุงุฏูุงุช ุงููุณุชุฎุฏูุฉ:');
console.log('   ุฅุฌูุงูู ุงูุฅุถุงูู = (ุงูุนุทู ร ุงูุฑุงุชุจ ุงูุฃุณุงุณู ร 0.5) + (ุงูุฌูุน ูุงูุนุทู ร ุงูุฑุงุชุจ ุงูุฃุณุงุณู) + (ุงูุฅุถุงูู ุจุนุฏ ุงููุฑุฌุน ร ุงูุฑุงุชุจ ุงูุฃุณุงุณู)');
console.log('   ุฅุฌูุงูู ุงูุฑุงุชุจ = ุฃูุงู ุงูุดูุฑ ร ุงูุฑุงุชุจ ุงูุฃุณุงุณู');
console.log('   ุตุงูู ุงูุฑุงุชุจ = ุฅุฌูุงูู ุงูุฑุงุชุจ + ุฅุฌูุงูู ุงูุฅุถุงูู');

console.log('\n๐ก ููููู ุงูุขู:');
console.log('   1. ูุชุญ ุงูููู ูุชุนุฏูู ุงูุจูุงูุงุช');
console.log('   2. ุฅุถุงูุฉ ููุธููู ุฌุฏุฏ');
console.log('   3. ุงุณุชุฎุฏุงู ุงูุณูุฑูุจุช ูุฑูุน ุงูุจูุงูุงุช: node scripts/import-excel-updated.mjs excel-template-updated.xlsx 2025-01');
